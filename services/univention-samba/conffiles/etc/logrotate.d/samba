@%@UCRWARNING=# @%@

@!@
import univention.lib.ucrLogrotate

name = "log.smbd"
settings = univention.lib.ucrLogrotate.getLogrotateConfig(name, configRegistry)

print("/var/log/samba/%s {" % name)

for setting in sorted(settings):
	print("\t%s" % settings[setting])
	print("\tpostrotate")
	print("\t\t/etc/init.d/samba reload > /dev/null")
	print("\tendscript")
	print("}")

name = "log.nmbd"
settings = univention.lib.ucrLogrotate.getLogrotateConfig(name, configRegistry)

print("/var/log/samba/%s {" % name)

for setting in sorted(settings):
	print("\t%s" % settings[setting])
	print("\tpostrotate")
	print("\t\t[ ! -f /var/run/samba/nmbd.pid ] || kill -HUP `cat /var/run/samba/nmbd.pid`")
	print("\tendscript")
	print("}")

for name in ('log.samba-dcerpcd', 'log.rpcd_*'):
	print("/var/log/samba/%s " % name, end="")
print("{")
for setting in sorted(settings):
	print("\t%s" % settings[setting])
print("\tsharedscripts")
print("\tpostrotate")
print("\t\t{ pidof samba-dcerpcd && pkill --signal HUP samba-dcerpcd; } > /dev/null")
print("\tendscript")
print("}")
@!@
